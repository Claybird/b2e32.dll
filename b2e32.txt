=======================================================================
    B2E32.dll Ver.0.07
                          by Claybird <claybird.without.wing@gmail.com>
                                  http://claybird.sakura.ne.jp/
=======================================================================
                                                          Nov.21,2012

§B2E32.dllとは？
 k.inabaさんの作成されたアーカイバ"Noah 3.195"の機能のうち、B2E(Bridge 
To Executables)スクリプトエンジン部分を統合アーカイバプロジェクト仕様の
DLLに移植したものです。
 単体では動きません。対応したアプリケーションと共にお使いください。

 Ver.0.02からは、サンプルアプリケーションのB2ECmd.exeが付属しています。
このB2ECmd.exeおよびそのソースコードB2ECmd.cはご自由にお使いください。

§動作確認済みOS
・Windows 7 Professional SP1


§注意点
 このプログラムは、その動作を保証するものではありません。その点をよく
理解した上でご利用ください。
 また、バグを発見された場合には作者(Claybird)までお知らせください。
B2E32.dllについての質問を、Noah作者のk.inaba氏に問い合わせることはおや
めください。

※Directory Traversal問題に対する対策は技術的な制限から行っていません。


§利用条件
 NYSL ver 0.9982を適用します。

  --- NYSL ver 0.9982 ( http://www.kmonos.net/nysl/ ) ---

    A. 本ソフトウェアは Everyone'sWare です。このソフトを手にした一人一人が、
       ご自分の作ったものを扱うのと同じように、自由に利用することが出来ます。

      A-1. フリーウェアです。作者からは使用料等を要求しません。
      A-2. 有料無料や媒体の如何を問わず、自由に転載・再配布できます。
      A-3. いかなる種類の 改変・他プログラムでの利用 を行っても構いません。
      A-4. 変更したものや部分的に使用したものは、あなたのものになります。
           公開する場合は、あなたの名前の下で行って下さい。

    B. このソフトを利用することによって生じた損害等について、作者は
       責任を負わないものとします。各自の責任においてご利用下さい。

    C. 著作者人格権は Claybird に帰属します。著作権は放棄します。

    D. 以上の３項は、ソース・実行バイナリの双方に適用されます。


--------------------------
    開発者向け情報
--------------------------
・基本的にはUnlha32.dllの説明が流用できます。

・APIの名前は全てB2Eから始まります。また、BtoEから始まる別名APIを実装してあります。

・ほとんどのAPIはエクスポートしてありますが、そのうち中身がきちんと実装されている
  物は限られています。API.TXTを参照してください。

・スレッドセーフではありません。一応内部で二重起動のチェックを行っています。

・B2Eスクリプトの場所は「(B2E32.dllのあるディレクトリ)\B2E\」がデフォルトですが、
  B2E32.dll独自APIにより変更可能です。

§B2E()のコマンド

書式 :
    -<command> <archive_file_name> [<path_name>|-@<resp>]



コマンド：
-c<形式名> : 圧縮を指示。形式も指定します。大文字小文字の違いは無視されます。
  例：-cDGCA

-a : 既存書庫にファイルを追加。

-d : 既存書庫からファイルを削除します。

-m<メソッド名> : 圧縮メソッドを指定。省略するとデフォルト圧縮メソッドが使われます。
  大文字小文字の違いは無視されます。
  例：-mRecoveryData

-s : 自己解凍形式で圧縮

-e : 解凍。使用するB2Eは自動的に探し出します。

-g : 解凍時、パス情報を無視

-l : 圧縮ファイル中のファイルを列挙

-o<dir> : 解凍時の出力先指定
  例：-oC:\Outputs\
    解凍時にはこのオプションを出来るだけつけるようにしてください。

-@<resp> : レスポンスファイル指定。レスポンスファイルにはコマンドを記入することは出来ません
  レスポンスファイルには一行につき一ファイルを記述してください。
  例：-@C:\temp\resp.txt

-- : 以降のパラメータを全てファイル名と見なす。-で始まる名前を指定する時に使います


・コマンドの大文字小文字は区別しません。

・空白文字を含むパス名などを指定する際には、オプション全体を""で括ってください。
  例："-@c:\test file\resp.txt"

・B2E()のログの改行は\r\nです。


§拡張文法
B2E32.dll Ver.0.07からは、NoahオリジナルのB2E文法を一部拡張し、機能を追加しています。
・mod_scan / mod_xscan
  オリジナルのscan/xscanとほぼ同じですが、空白が連続する場合でもファイル名として認識する
  点が違います。

・arc関数の拡張引数
  オリジナルの挙動「(arc[+-].xxx [slfrd])」に加え、引数'a'および'x'が追加されています。
    'a' : ファイルの拡張子を全て残します。
    'x' : ファイルの最後の拡張子以外を残します。
  元はNoahの隠し設定で行われていた処理です。

  例えば、"file.abc.def.txt"を圧縮する場合、
    (arc.zip a) => "file.abc.def.txt.zip"
    (arc.zip x) => "file.abc.def.zip"
  となります。

・add:セクション
  アーカイブにファイルを追加するときに使用します。書式はencode: や sfx:セクションとほぼ同様です。

・delete:セクション
  アーカイブからファイルを削除するときに使用します。書式はencode: や sfx:セクションとほぼ同様です。

§ソースコードについて
 オリジナルNoahのソースをできるだけ流用しましたが、所々自分に都合の良いように変更してあります。
 kilibの一部ファイルにまで手を出してあるので、ご注意ください。



§更新履歴
2012/11/21 Ver.0.07
                   ・正式版としてリリース

2012/ 9/30 Ver.0.07(Beta3)
                   ・ショートファイル名が取得できないファイルを扱うと、バッファ
                     オーバーフローが起きることがあった問題を修正

2012/ 4/18 Ver.0.07(Beta2)
                   ・バイナリ植え付け問題対策のため、DLLロード処理/実行ファイル
                     検索処理を修正
                   ・コメントのためにcomment関数を追加

2012/ 4/15 Ver.0.07(Beta)
                   ・開発環境をVisual C++ 2005に移行
                   ・圧縮時、ファイル名にワイルドカードを指定できるようにした
                   ・add: / delete: セクションを追加
                   ・mod_scan / mod_xscan を追加
                   ・arc関数に引数を追加

2008/ 4/20 Ver.0.06
                   ・正式版としてリリース

2008/ 4/ 5 Ver.0.06(Beta)
                   ・解凍時、圧縮ファイル名にワイルドカードを指定できるように
                     した
                   ・圧縮ファイル中のファイル一覧表示(-lオプション)に対応
                   ・圧縮時、圧縮ファイル名をフルパスで指定しないときにカレント
                     以外のフォルダに出力されてしまうことがある問題に対応
                   ・エラー時、ダイアログボックスは出さずログに出力するだけに
                     した

2008/ 1/ 8 Ver.0.05
                   ・正式版としてリリース

2007/12/28 Ver.0.05(限定公開)
                   ・B2EGetFileCount()が正しく動作しないことがあった問題を修正

2007/ 4/ 1 Ver.0.04
                   ・正式版としてリリース

2007/ 3/19 Ver.0.04(Beta2)
                   ・環境ブロック指定が不十分だったために一部コマンドが実行でき
                     なかった不具合を修正
                   ・メモリリークする可能性があったので修正

2007/ 3/17 Ver.0.04(Beta)
                   ・ヘッダのスペルミスを修正
                   ・解凍に使用するB2Eのインデックスを取得するためのAPI
                     B2EScriptGetExtractorIndex()を実装
                   ・書庫内ファイル一覧を取得する時、ゴミデータが返ることが
                     あった問題を修正
                   ・不要なソースファイルを削除
                   ・B2Eの能力が正しく取得されていなかったことがある問題を修正
                   ・レスポンスファイルの読み取りを改善
                   ・メソッド名を指定する時、メソッド名の大文字小文字を無視して
                     比較するようにした
                   ・存在しないメソッド名を指定した場合には内部で勝手にデフォル
                     トメソッドを使うのではなくエラーとするようにした
                   ・自己解凍書庫作成時、一時ファイルがコピーされてしまうことが
                     ある不具合を修正

2007/ 2/ 6  Ver.0.03
                   ・オプションのエラーチェックを強化
                   ・B2Eの入力ダイアログタイトルがNoahのままだったのを修正
                   ・パス無視で解凍するためのオプションを追加(-g)
                   ・アーカイブファイル名の取得方法を改善

2007/ 1/27 Ver.0.02
                   ・カレントディレクトリの制御をきちんと行うようにした
                   ・B2Eスクリプトから呼び出される実行ファイルやDLLはスクリプト
                     と同じフォルダに入れた時も動作するようにした
                   ・B2E32.dllを使ったプログラムのサンプルとしてB2ECmdを添付
                   ・自己解凍形式で圧縮できなかったことがある問題を修正

2007/ 1/ 9  Ver.0.01
                   ・初版公開

